import{q as J,r as b,D as P,c as W,b as U,o as d,e as c,f as o,g as m,s as q,h as w,m as S,G as j,T,v as D,x,H as F,d as g,F as C,p as O,I as N,J as E,n as L,z as M,A as z}from"./framework.CyD6RqvT.js";var I={fetch:globalThis.fetch,WebSocket:globalThis.WebSocket,URL:globalThis.URL},G=(e,t={})=>{let a=t.globals?{...I,...t.globals}:I;return{globals:a,url:new a.URL(e),with(s){return{...this,...s(this)}}}};function Y(e){return typeof e!="object"||!e?!1:"headers"in e&&"ok"in e&&"json"in e&&typeof e.json=="function"&&"text"in e&&typeof e.json=="function"}async function H(e){var t;if(!(typeof e!="object"||!e)){if(Y(e)){let a=(t=e.headers.get("Content-Type"))==null?void 0:t.toLowerCase();if(a!=null&&a.startsWith("application/json")||a!=null&&a.startsWith("application/health+json")){let s=await e.json();if(!e.ok)throw s;return"data"in s?s.data:s}if(a!=null&&a.startsWith("text/html")||a!=null&&a.startsWith("text/plain")){let s=await e.text();if(!e.ok)throw s;return s}return e}return"data"in e?e.data:e}}var K=async(e,t,a=globalThis.fetch)=>{t.headers=typeof t.headers=="object"&&!Array.isArray(t.headers)?t.headers:{};let s=await a(e,t);return H(s).catch(l=>{throw{errors:typeof l=="object"&&"errors"in l?l.errors:l,response:s}})},Q=(e,t)=>()=>({path:"/files",method:"POST",body:e,params:t??{},headers:{"Content-Type":"multipart/form-data"}}),X=(e,t,a)=>()=>{let s=String(e);if(s.startsWith("directus_"))throw new Error("Cannot use createItem for core collections");return{path:`/items/${s}`,params:a??{},body:JSON.stringify(t),method:"POST"}},Z=e=>{let t={};if(Array.isArray(e.fields)&&e.fields.length>0){let a=(s,l=[])=>{if(typeof s=="object"){let f=[];for(let r in s){let u=s[r]??[];if(Array.isArray(u))for(let p of u)f.push(a(p,[...l,r]));else if(typeof u=="object")for(let p of Object.keys(u)){let A=u[p];for(let h of A)f.push(a(h,[...l,`${r}:${p}`]))}}return f.flatMap(r=>r)}return[...l,String(s)].join(".")};t.fields=e.fields.flatMap(s=>a(s)).join(",")}e.filter&&Object.keys(e.filter).length>0&&(t.filter=JSON.stringify(e.filter)),e.search&&(t.search=e.search),"sort"in e&&e.sort&&(t.sort=typeof e.sort=="string"?e.sort:e.sort.join(",")),typeof e.limit=="number"&&e.limit>=-1&&(t.limit=String(e.limit)),typeof e.offset=="number"&&e.offset>=0&&(t.offset=String(e.offset)),typeof e.page=="number"&&e.page>=1&&(t.page=String(e.page)),e.deep&&Object.keys(e.deep).length>0&&(t.deep=JSON.stringify(e.deep)),e.alias&&Object.keys(e.alias).length>0&&(t.alias=JSON.stringify(e.alias)),e.aggregate&&Object.keys(e.aggregate).length>0&&(t.aggregate=JSON.stringify(e.aggregate)),e.groupBy&&e.groupBy.length>0&&(t.groupBy=e.groupBy.join(","));for(let[a,s]of Object.entries(e))a in t||(typeof s=="string"||typeof s=="number"||typeof s=="boolean"?t[a]=String(s):t[a]=JSON.stringify(s));return t},B=(e,t)=>{if(e.length===0)throw new Error(t)},ee=(e,t)=>{if(String(e).startsWith("directus_"))throw new Error(t)},te=(e,t,a)=>()=>(B(String(e),"Collection cannot be empty"),ee(e,"Cannot use readItem for core collections"),B(String(t),"Key cannot be empty"),{path:`/items/${e}/${t}`,params:a??{},method:"GET"}),ae={},se=(e={})=>t=>{let a={...ae,...e};return{async request(s){let l=s();if(l.headers||(l.headers={}),"Content-Type"in l.headers?l.headers["Content-Type"]==="multipart/form-data"&&delete l.headers["Content-Type"]:l.headers["Content-Type"]="application/json","getToken"in this){let p=await this.getToken();p&&(l.headers||(l.headers={}),l.headers.Authorization=`Bearer ${p}`)}let f=le(t.url,l.path,l.params),r={method:l.method??"GET",headers:l.headers??{}};"credentials"in a&&(r.credentials=a.credentials),l.body&&(r.body=l.body),l.onRequest&&(r=await l.onRequest(r)),a.onRequest&&(r=await a.onRequest(r));let u=await K(f.toString(),r,t.globals.fetch);return"onResponse"in l&&(u=await l.onResponse(u,r)),"onResponse"in e&&(u=await e.onResponse(u,r)),u}}},R="/",oe=(e,t)=>(e.endsWith(R)&&(e=e.slice(0,-1)),t.startsWith(R)||(t=R+t),e+t),le=(e,t,a)=>{let s=e.pathname===R?t:oe(e.pathname,t),l=new globalThis.URL(s,e);if(a)for(let[f,r]of Object.entries(Z(a)))if(r&&typeof r=="object"&&!Array.isArray(r))for(let[u,p]of Object.entries(r))l.searchParams.set(`${f}[${u}]`,String(p));else l.searchParams.set(f,r);return l};const _=e=>(M("data-v-0d831aae"),e=e(),z(),e),re={class:"my-8"},ie={class:"flex gap-2 max-w-140 mb-4 text-xl"},ne={class:"p-0"},de=_(()=>o("div",{class:"flex-auto"},null,-1)),ce={key:0,class:"p-0 flex items-center gap-2"},ue=_(()=>o("div",{class:"i-la-star-solid text-yellow-500 text-lg"},null,-1)),he={key:0,class:"i-la-angle-down"},fe={key:1,class:"i-la-angle-up"},pe={key:0,class:"p-4 bg-light-900 dark-bg-dark-200 max-w-140"},ge={class:"text-lg flex items-center gap-0",for:"rating"},_e=_(()=>o("div",{class:"flex-1"},null,-1)),ye={class:"px-2"},ve={class:"opacity-70 hover-opacity-100 gap-1 flex"},me=["onClick"],be={key:0,class:"i-la-star-solid"},xe={key:1,class:"i-la-star"},ke={class:"flex flex-wrap gap-2"},we={class:"flex flex-col gap-2 flex-1"},Se=_(()=>o("label",{class:"text-lg",for:"author"},"Author *",-1)),je={class:"flex flex-col gap-2 flex-1"},Te=_(()=>o("label",{class:"text-lg",for:"author_link"},"Profile link",-1)),Ce={class:"flex flex-col gap-2"},Oe=_(()=>o("label",{class:"text-lg",for:"form-content"},"Content *",-1)),Re={class:"flex flex-col gap-2"},Ae=_(()=>o("label",{class:"text-lg",for:"files"},"Files",-1)),$e=_(()=>o("div",{class:"opacity-40"},"All reviews are manually moderated before being published.",-1)),Ne=["disabled"],We={key:0,class:"text-red-500"},qe={key:1,class:"p-0"},De={class:"flex flex-wrap gap-4"},Fe={class:"flex flex-col gap-4",style:{flex:"1 1 200px"}},Ie={class:"p-4 flex-1 relative"},Be={class:"flex text-yellow-500 mb-2"},Ve={class:"text-lg mb-4 flex items-center gap-2"},Je={class:"p-0"},Pe=["href"],Ue=_(()=>o("div",{class:"flex-1"},null,-1)),Ee={class:"p-0 text-xs"},Le={class:"text-md"},Me={key:0,class:"mt-2"},ze=["src"],Ge={__name:"ProductReviews",props:{product:{type:String,default:""}},setup(e){const t=e,a=G("https://db.chromatone.center/").with(se()),s=b([]);P(async()=>{let v=await a.request(te("products",t.product,{fields:[{reviews:["*"]}]}));s.value=v.reviews.sort((n,y)=>n.date<y.date?1:-1)});const l=W(()=>s.value.reduce((v,n)=>v+=n.rating,0)/s.value.length),f=b(!1),r=b(!1),u=b(!1),p=b(null),A=v=>{p.value=v.target.files[0]},h=U({status:"draft",date:new Date().toISOString().split("T")[0],content:"",rating:5,author:"",author_link:"",product:t.product});async function V(v){const n=new FormData;n.append("folder","b84d5f23-aa89-498e-840d-9d34d79aa4fa"),n.append("file",p.value);let y=await a.request(Q(n));h.cover=y==null?void 0:y.id;let i=await a.request(X("reviews",h));console.log(i),u.value=!0}const $=W(()=>h.author&&h.content);return(v,n)=>{var y;return d(),c("div",re,[o("div",ie,[o("div",{class:"rounded p-4 flex gap-4 cursor-pointer bg-light-900 dark-bg-dark-200 flex-auto",onClick:n[0]||(n[0]=i=>f.value=!f.value)},[o("div",ne,"Reviews ("+m(s.value.length)+")",1),de,((y=s.value)==null?void 0:y.length)>0?(d(),c("div",ce,[q(m(l.value.toFixed(1)),1),ue])):w("",!0),S(T,{name:"fade",mode:"out-in"},{default:j(()=>[f.value?(d(),c("div",fe)):(d(),c("div",he))]),_:1})]),o("button",{class:"p-4 bg-light-900 dark-bg-dark-200 rounded",onClick:n[1]||(n[1]=i=>r.value=!r.value),title:"Add a review","aria-label":"Add a review"},[o("div",{class:D(["i-la-plus",{"-rotate-45":r.value}])},null,2)])]),S(T,{name:"fade"},{default:j(()=>[u.value?(d(),c("div",pe,"Thank you! Your review has been submitted. It will be published after moderation.")):w("",!0)]),_:1}),S(T,{name:"fade"},{default:j(()=>[x(o("form",{class:"flex flex-col p-4 bg-light-900 dark-bg-dark-200 max-w-140 gap-4",onSubmit:E(V,["prevent","stop"])},[o("div",ge,[q("Rating "),_e,o("div",ye,m(g(h).rating),1),o("div",ve,[(d(),c(C,null,O(5,i=>o("div",{class:"p-0 text-yellow-500 cursor-pointer",key:i,onClick:k=>g(h).rating=i},[i<=g(h).rating?(d(),c("div",be)):(d(),c("div",xe))],8,me)),64))])]),o("div",ke,[o("div",we,[Se,x(o("input",{id:"author","onUpdate:modelValue":n[2]||(n[2]=i=>g(h).author=i),placeholder:"Your name"},null,512),[[N,g(h).author]])]),o("div",je,[Te,x(o("input",{id:"author_link","onUpdate:modelValue":n[3]||(n[3]=i=>g(h).author_link=i),placeholder:"A link to your social profile"},null,512),[[N,g(h).author_link]])])]),o("div",Ce,[Oe,x(o("textarea",{id:"form-content","onUpdate:modelValue":n[4]||(n[4]=i=>g(h).content=i),rows:"3",placeholder:"Describe your experience with the product"},null,512),[[N,g(h).content]])]),o("div",Re,[Ae,o("input",{id:"files",type:"file",name:"file",accept:"image/*",onChange:A,placeholder:"Describe your experience with the product"},null,32)]),$e,o("button",{class:D(["p-4 bg-light-500 shadow rounded dark-bg-dark-800",{"opacity-50":!$.value}]),type:"submit",disabled:!$.value},[$.value?(d(),c("div",qe,"Submit")):(d(),c("div",We,"Please fill in your name and add review content"))],10,Ne)],544),[[F,r.value&&!u.value]])]),_:1}),S(T,{name:"fade"},{default:j(()=>[x(o("div",De,[(d(!0),c(C,null,O(s.value,i=>(d(),c("div",{class:"shadow flex flex-wrap bg-light-400 dark-bg-dark-400 max-w-140",style:L({flex:`${i.cover?1e3:1} 1 280px`}),key:i},[o("div",Fe,[o("div",Ie,[o("div",Be,[(d(!0),c(C,null,O(i.rating,k=>(d(),c("div",{class:"i-la-star-solid",key:k}))),128)),(d(!0),c(C,null,O(5-i.rating,k=>(d(),c("div",{class:"i-la-star",key:k}))),128))]),o("div",Ve,[o("div",Je,m(i.author),1),i.author_link?(d(),c("a",{key:0,class:"i-la-link",target:"_blank",href:i.author_link},null,8,Pe)):w("",!0),Ue,o("div",Ee,m(i.date),1)]),o("div",Le,m(i.content),1),i.cover?(d(),c("div",Me,[o("img",{class:"w-full max-w-50",src:`https://db.chromatone.center/assets/${i.cover}&w=10`},null,8,ze)])):w("",!0)])])],4))),128))],512),[[F,f.value]])]),_:1})])}}},He=J(Ge,[["__scopeId","data-v-0d831aae"]]);export{He as _};
