import{_ as J,r as m,J as V,c as $,b as D,o as c,d as u,e as r,f as y,P,g as x,q as k,Q as w,a1 as j,v as N,S as b,X as q,F as S,j as T,a0 as A,W as L,p as E}from"./framework.CVursDuZ.js";var C="/",I=(e,t)=>(e.endsWith(C)&&(e=e.slice(0,-1)),t.startsWith(C)||(t=C+t),e+t),M=(e,t,s)=>{let i=e.pathname===C?t:I(e.pathname,t),a=new globalThis.URL(i,e);if(s)for(let[d,n]of Object.entries(Z(s)))if(n&&typeof n=="object"&&!Array.isArray(n))for(let[f,h]of Object.entries(n))a.searchParams.set(`${d}[${f}]`,String(h));else a.searchParams.set(d,n);return a};function z(e){return typeof e!="object"||!e?!1:"headers"in e&&"ok"in e&&"json"in e&&typeof e.json=="function"&&"text"in e&&typeof e.json=="function"}async function K(e){var t;if(!(typeof e!="object"||!e)){if(z(e)){let s=(t=e.headers.get("Content-Type"))==null?void 0:t.toLowerCase();if(s!=null&&s.startsWith("application/json")||s!=null&&s.startsWith("application/health+json")){let i=await e.json();if(!e.ok||"errors"in i)throw i;return"data"in i?i.data:i}if(s!=null&&s.startsWith("text/html")||s!=null&&s.startsWith("text/plain")){let i=await e.text();if(!e.ok)throw i;return i}return e.status===204?null:e}if("errors"in e)throw e;return"data"in e?e.data:e}}var G=async(e,t,s=globalThis.fetch)=>(t.headers=typeof t.headers=="object"&&!Array.isArray(t.headers)?t.headers:{},s(e,t).then(i=>K(i).catch(a=>{let d={errors:a&&typeof a=="object"&&"errors"in a?a.errors:a,response:i};return a&&typeof a=="object"&&"data"in a&&(d.data=a.data),Promise.reject(d)}))),B={fetch:globalThis.fetch,WebSocket:globalThis.WebSocket,URL:globalThis.URL,logger:globalThis.console},Y=(e,t={})=>{let s=t.globals?{...B,...t.globals}:B;return{globals:s,url:new s.URL(e),with(i){return{...this,...i(this)}}}},Q=(e,t)=>()=>({path:"/files",method:"POST",body:e,params:t??{},headers:{"Content-Type":"multipart/form-data"}});function W(e){return["directus_access","directus_activity","directus_collections","directus_comments","directus_fields","directus_files","directus_folders","directus_migrations","directus_permissions","directus_policies","directus_presets","directus_relations","directus_revisions","directus_roles","directus_sessions","directus_settings","directus_users","directus_webhooks","directus_dashboards","directus_panels","directus_notifications","directus_shares","directus_flows","directus_operations","directus_translations","directus_versions","directus_extensions"].includes(e)}var X=(e,t,s)=>()=>{let i=String(e);if(W(i))throw new Error("Cannot use createItem for core collections");return{path:`/items/${i}`,params:s??{},body:JSON.stringify(t),method:"POST"}},H=e=>{let t=(s,i=[])=>{if(typeof s=="object"){let a=[];for(let d in s){let n=s[d]??[];if(Array.isArray(n))for(let f of n)a.push(t(f,[...i,d]));else if(typeof n=="object")for(let f of Object.keys(n)){let h=n[f];for(let O of h)a.push(t(O,[...i,`${d}:${f}`]))}}return a.flatMap(d=>d)}return[...i,String(s)].join(".")};return e.flatMap(s=>t(s))},Z=e=>{let t={};Array.isArray(e.fields)&&e.fields.length>0&&(t.fields=H(e.fields).join(",")),e.filter&&Object.keys(e.filter).length>0&&(t.filter=JSON.stringify(e.filter)),e.search&&(t.search=e.search),"sort"in e&&e.sort&&(t.sort=typeof e.sort=="string"?e.sort:e.sort.join(",")),typeof e.limit=="number"&&e.limit>=-1&&(t.limit=String(e.limit)),typeof e.offset=="number"&&e.offset>=0&&(t.offset=String(e.offset)),typeof e.page=="number"&&e.page>=1&&(t.page=String(e.page)),e.deep&&Object.keys(e.deep).length>0&&(t.deep=JSON.stringify(e.deep)),e.alias&&Object.keys(e.alias).length>0&&(t.alias=JSON.stringify(e.alias)),e.aggregate&&Object.keys(e.aggregate).length>0&&(t.aggregate=JSON.stringify(e.aggregate)),e.groupBy&&e.groupBy.length>0&&(t.groupBy=e.groupBy.join(","));for(let[s,i]of Object.entries(e))s in t||(typeof i=="string"||typeof i=="number"||typeof i=="boolean"?t[s]=String(i):t[s]=JSON.stringify(i));return t},U=(e,t)=>{if(e.length===0)throw new Error(t)},ee=(e,t)=>{if(W(String(e)))throw new Error(t)},te=(e,t,s)=>()=>(U(String(e),"Collection cannot be empty"),ee(e,"Cannot use readItem for core collections"),U(String(t),"Key cannot be empty"),{path:`/items/${e}/${t}`,params:s??{},method:"GET"}),se={},ae=(e={})=>t=>{let s={...se,...e};return{async request(i){let a=i();if(a.headers||(a.headers={}),"Content-Type"in a.headers?a.headers["Content-Type"]==="multipart/form-data"&&delete a.headers["Content-Type"]:a.headers["Content-Type"]="application/json","getToken"in this&&!("Authorization"in a.headers)){let h=await this.getToken();h&&(a.headers.Authorization=`Bearer ${h}`)}let d=M(t.url,a.path,a.params),n={method:a.method??"GET",headers:a.headers??{}};"credentials"in s&&(n.credentials=s.credentials),a.body&&(n.body=a.body),a.onRequest&&(n=await a.onRequest(n)),s.onRequest&&(n=await s.onRequest(n));let f=await G(d.toString(),n,t.globals.fetch);return"onResponse"in a&&(f=await a.onResponse(f,n)),"onResponse"in e&&(f=await e.onResponse(f,n)),f}}};const oe={class:"my-8"},re={class:"flex gap-2 max-w-140 mb-4 text-xl"},ie={class:"p-0"},le={key:0,class:"p-0 flex items-center gap-2"},ne={key:0,class:"i-la-angle-down"},de={key:1,class:"i-la-angle-up"},ce={key:0,class:"p-4 bg-light-900 dark-bg-dark-200 max-w-140"},ue={class:"text-lg flex items-center gap-0",for:"rating"},fe={class:"px-2"},pe={class:"opacity-70 hover-opacity-100 gap-1 flex"},he=["onClick"],ge={key:0,class:"i-la-star-solid"},ve={key:1,class:"i-la-star"},ye={class:"flex flex-wrap gap-2"},me={class:"flex flex-col gap-2 flex-1"},be={class:"flex flex-col gap-2 flex-1"},_e={class:"flex flex-col gap-2"},xe={class:"flex flex-col gap-2"},ke=["disabled"],we={key:0,class:"text-red-500"},je={key:1,class:"p-0"},Se={class:"flex flex-wrap gap-4"},Te={class:"flex flex-col gap-4",style:{flex:"1 1 200px"}},Ce={class:"p-4 flex-1 relative"},Oe={class:"flex text-yellow-500 mb-2"},Re={class:"text-lg mb-4 flex items-center gap-2"},Ae={class:"p-0"},$e=["href"],Pe={class:"p-0 text-xs"},Ne={class:"text-md"},qe={key:0,class:"mt-2"},Be=["src"],Ue={__name:"ProductReviews",props:{product:{type:String,default:""}},setup(e){const t=e,s=Y("https://db.chromatone.center/").with(ae()),i=m([]);V(async()=>{let g=await s.request(te("products",t.product,{fields:[{reviews:["*"]}]}));i.value=g.reviews.sort((o,v)=>o.date<v.date?1:-1)});const a=$(()=>i.value.reduce((g,o)=>g+=o.rating,0)/i.value.length),d=m(!1),n=m(!1),f=m(!1),h=m(null),O=g=>{h.value=g.target.files[0]},p=D({status:"draft",date:new Date().toISOString().split("T")[0],content:"",rating:5,author:"",author_link:"",product:t.product});async function F(g){const o=new FormData;if(h.value){o.append("folder","b84d5f23-aa89-498e-840d-9d34d79aa4fa"),o.append("file",h.value);let l=await s.request(Q(o));p.cover=l==null?void 0:l.id}let v=await s.request(X("reviews",p));console.log(v),f.value=!0}const R=$(()=>p.author&&p.content);return(g,o)=>{var v;return c(),u("div",oe,[r("div",re,[r("div",{class:"rounded p-4 flex gap-4 cursor-pointer bg-light-900 dark-bg-dark-200 flex-auto",onClick:o[0]||(o[0]=l=>d.value=!d.value)},[r("div",ie,"Reviews ("+y(i.value.length)+")",1),o[6]||(o[6]=r("div",{class:"flex-auto"},null,-1)),((v=i.value)==null?void 0:v.length)>0?(c(),u("div",le,[P(y(a.value.toFixed(1)),1),o[5]||(o[5]=r("div",{class:"i-la-star-solid text-yellow-500 text-lg"},null,-1))])):x("",!0),k(j,{name:"fade",mode:"out-in"},{default:w(()=>[d.value?(c(),u("div",de)):(c(),u("div",ne))]),_:1})]),r("button",{class:"p-4 bg-light-900 dark-bg-dark-200 rounded",onClick:o[1]||(o[1]=l=>n.value=!n.value),title:"Add a review","aria-label":"Add a review"},[r("div",{class:N(["i-la-plus",{"-rotate-45":n.value}])},null,2)])]),k(j,{name:"fade"},{default:w(()=>[f.value?(c(),u("div",ce,"Thank you! Your review has been submitted. It will be published after moderation.")):x("",!0)]),_:1}),k(j,{name:"fade"},{default:w(()=>[b(r("form",{class:"flex flex-col p-4 bg-light-900 dark-bg-dark-200 max-w-140 gap-4",onSubmit:L(F,["prevent","stop"])},[r("div",ue,[o[7]||(o[7]=P("Rating ")),o[8]||(o[8]=r("div",{class:"flex-1"},null,-1)),r("div",fe,y(p.rating),1),r("div",pe,[(c(),u(S,null,T(5,l=>r("div",{class:"p-0 text-yellow-500 cursor-pointer",key:l,onClick:_=>p.rating=l},[l<=p.rating?(c(),u("div",ge)):(c(),u("div",ve))],8,he)),64))])]),r("div",ye,[r("div",me,[o[9]||(o[9]=r("label",{class:"text-lg",for:"author"},"Author *",-1)),b(r("input",{id:"author","onUpdate:modelValue":o[2]||(o[2]=l=>p.author=l),placeholder:"Your name"},null,512),[[A,p.author]])]),r("div",be,[o[10]||(o[10]=r("label",{class:"text-lg",for:"author_link"},"Profile link",-1)),b(r("input",{id:"author_link","onUpdate:modelValue":o[3]||(o[3]=l=>p.author_link=l),placeholder:"A link to your social profile"},null,512),[[A,p.author_link]])])]),r("div",_e,[o[11]||(o[11]=r("label",{class:"text-lg",for:"form-content"},"Content *",-1)),b(r("textarea",{id:"form-content","onUpdate:modelValue":o[4]||(o[4]=l=>p.content=l),rows:"3",placeholder:"Describe your experience with the product"},null,512),[[A,p.content]])]),r("div",xe,[o[12]||(o[12]=r("label",{class:"text-lg",for:"files"},"Files",-1)),r("input",{id:"files",type:"file",name:"file",accept:"image/*",onChange:O,placeholder:"Describe your experience with the product"},null,32)]),o[13]||(o[13]=r("div",{class:"opacity-40"},"All reviews are manually moderated before being published.",-1)),r("button",{class:N(["p-4 bg-light-500 shadow rounded dark-bg-dark-800",{"opacity-50":!R.value}]),type:"submit",disabled:!R.value},[R.value?(c(),u("div",je,"Submit")):(c(),u("div",we,"Please fill in your name and add review content"))],10,ke)],544),[[q,n.value&&!f.value]])]),_:1}),k(j,{name:"fade"},{default:w(()=>[b(r("div",Se,[(c(!0),u(S,null,T(i.value,l=>(c(),u("div",{class:"shadow flex flex-wrap bg-light-400 dark-bg-dark-400 max-w-140",style:E({flex:`${l.cover?1e3:1} 1 280px`}),key:l},[r("div",Te,[r("div",Ce,[r("div",Oe,[(c(!0),u(S,null,T(l.rating,_=>(c(),u("div",{class:"i-la-star-solid",key:_}))),128)),(c(!0),u(S,null,T(5-l.rating,_=>(c(),u("div",{class:"i-la-star",key:_}))),128))]),r("div",Re,[r("div",Ae,y(l.author),1),l.author_link?(c(),u("a",{key:0,class:"i-la-link",target:"_blank",href:l.author_link},null,8,$e)):x("",!0),o[14]||(o[14]=r("div",{class:"flex-1"},null,-1)),r("div",Pe,y(l.date),1)]),r("div",Ne,y(l.content),1),l.cover?(c(),u("div",qe,[r("img",{class:"w-full max-w-50",src:`https://db.chromatone.center/assets/${l.cover}&w=10`},null,8,Be)])):x("",!0)])])],4))),128))],512),[[q,d.value]])]),_:1})])}}},Fe=J(Ue,[["__scopeId","data-v-8358ddc2"]]);export{Fe as P};
