import{_ as V,r as _,o as W,d as B,e as L,f as c,h as u,j as r,t as m,B as N,k,y as w,C as j,H as S,A as U,D as b,I as q,u as g,F as T,m as C,J as $,K as E,x as I}from"./framework.BCRafsq3.js";var A="/",M=(e,t)=>(e.endsWith(A)&&(e=e.slice(0,-1)),t.startsWith(A)||(t=A+t),e+t),z=(e,t,s)=>{let i=e.pathname===A?t:M(e.pathname,t),a=new globalThis.URL(i,e);if(s)for(let[d,n]of Object.entries(ee(s)))if(n&&typeof n=="object"&&!Array.isArray(n))for(let[f,h]of Object.entries(n))a.searchParams.set(`${d}[${f}]`,String(h));else a.searchParams.set(d,n);return a};function K(e){return typeof e!="object"||!e?!1:"headers"in e&&"ok"in e&&"json"in e&&typeof e.json=="function"&&"text"in e&&typeof e.json=="function"}async function G(e){var t;if(!(typeof e!="object"||!e)){if(K(e)){let s=(t=e.headers.get("Content-Type"))==null?void 0:t.toLowerCase();if(s!=null&&s.startsWith("application/json")||s!=null&&s.startsWith("application/health+json")){let i=await e.json();if(!e.ok||"errors"in i)throw i;return"data"in i?i.data:i}if(s!=null&&s.startsWith("text/html")||s!=null&&s.startsWith("text/plain")){let i=await e.text();if(!e.ok)throw i;return i}return e}if("errors"in e)throw e;return"data"in e?e.data:e}}var Y=async(e,t,s=globalThis.fetch)=>(t.headers=typeof t.headers=="object"&&!Array.isArray(t.headers)?t.headers:{},s(e,t).then(i=>G(i).catch(a=>{let d={errors:a&&typeof a=="object"&&"errors"in a?a.errors:a,response:i};return a&&typeof a=="object"&&"data"in a&&(d.data=a.data),Promise.reject(d)}))),D={fetch:globalThis.fetch,WebSocket:globalThis.WebSocket,URL:globalThis.URL,logger:globalThis.console},H=(e,t={})=>{let s=t.globals?{...D,...t.globals}:D;return{globals:s,url:new s.URL(e),with(i){return{...this,...i(this)}}}},Q=(e,t)=>()=>({path:"/files",method:"POST",body:e,params:t??{},headers:{"Content-Type":"multipart/form-data"}});function J(e){return["directus_access","directus_activity","directus_collections","directus_comments","directus_fields","directus_files","directus_folders","directus_migrations","directus_permissions","directus_policies","directus_presets","directus_relations","directus_revisions","directus_roles","directus_sessions","directus_settings","directus_users","directus_webhooks","directus_dashboards","directus_panels","directus_notifications","directus_shares","directus_flows","directus_operations","directus_translations","directus_versions","directus_extensions"].includes(e)}var X=(e,t,s)=>()=>{let i=String(e);if(J(i))throw new Error("Cannot use createItem for core collections");return{path:`/items/${i}`,params:s??{},body:JSON.stringify(t),method:"POST"}},Z=e=>{let t=(s,i=[])=>{if(typeof s=="object"){let a=[];for(let d in s){let n=s[d]??[];if(Array.isArray(n))for(let f of n)a.push(t(f,[...i,d]));else if(typeof n=="object")for(let f of Object.keys(n)){let h=n[f];for(let O of h)a.push(t(O,[...i,`${d}:${f}`]))}}return a.flatMap(d=>d)}return[...i,String(s)].join(".")};return e.flatMap(s=>t(s))},ee=e=>{let t={};Array.isArray(e.fields)&&e.fields.length>0&&(t.fields=Z(e.fields).join(",")),e.filter&&Object.keys(e.filter).length>0&&(t.filter=JSON.stringify(e.filter)),e.search&&(t.search=e.search),"sort"in e&&e.sort&&(t.sort=typeof e.sort=="string"?e.sort:e.sort.join(",")),typeof e.limit=="number"&&e.limit>=-1&&(t.limit=String(e.limit)),typeof e.offset=="number"&&e.offset>=0&&(t.offset=String(e.offset)),typeof e.page=="number"&&e.page>=1&&(t.page=String(e.page)),e.deep&&Object.keys(e.deep).length>0&&(t.deep=JSON.stringify(e.deep)),e.alias&&Object.keys(e.alias).length>0&&(t.alias=JSON.stringify(e.alias)),e.aggregate&&Object.keys(e.aggregate).length>0&&(t.aggregate=JSON.stringify(e.aggregate)),e.groupBy&&e.groupBy.length>0&&(t.groupBy=e.groupBy.join(","));for(let[s,i]of Object.entries(e))s in t||(typeof i=="string"||typeof i=="number"||typeof i=="boolean"?t[s]=String(i):t[s]=JSON.stringify(i));return t},F=(e,t)=>{if(e.length===0)throw new Error(t)},te=(e,t)=>{if(J(String(e)))throw new Error(t)},se=(e,t,s)=>()=>(F(String(e),"Collection cannot be empty"),te(e,"Cannot use readItem for core collections"),F(String(t),"Key cannot be empty"),{path:`/items/${e}/${t}`,params:s??{},method:"GET"}),ae={},oe=(e={})=>t=>{let s={...ae,...e};return{async request(i){let a=i();if(a.headers||(a.headers={}),"Content-Type"in a.headers?a.headers["Content-Type"]==="multipart/form-data"&&delete a.headers["Content-Type"]:a.headers["Content-Type"]="application/json","getToken"in this&&!("Authorization"in a.headers)){let h=await this.getToken();h&&(a.headers.Authorization=`Bearer ${h}`)}let d=z(t.url,a.path,a.params),n={method:a.method??"GET",headers:a.headers??{}};"credentials"in s&&(n.credentials=s.credentials),a.body&&(n.body=a.body),a.onRequest&&(n=await a.onRequest(n)),s.onRequest&&(n=await s.onRequest(n));let f=await Y(d.toString(),n,t.globals.fetch);return"onResponse"in a&&(f=await a.onResponse(f,n)),"onResponse"in e&&(f=await e.onResponse(f,n)),f}}};const re={class:"my-8"},ie={class:"flex gap-2 max-w-140 mb-4 text-xl"},le={class:"p-0"},ne={key:0,class:"p-0 flex items-center gap-2"},de={key:0,class:"i-la-angle-down"},ce={key:1,class:"i-la-angle-up"},ue={key:0,class:"p-4 bg-light-900 dark-bg-dark-200 max-w-140"},fe={class:"text-lg flex items-center gap-0",for:"rating"},pe={class:"px-2"},he={class:"opacity-70 hover-opacity-100 gap-1 flex"},ge=["onClick"],ye={key:0,class:"i-la-star-solid"},ve={key:1,class:"i-la-star"},me={class:"flex flex-wrap gap-2"},_e={class:"flex flex-col gap-2 flex-1"},be={class:"flex flex-col gap-2 flex-1"},xe={class:"flex flex-col gap-2"},ke={class:"flex flex-col gap-2"},we=["disabled"],je={key:0,class:"text-red-500"},Se={key:1,class:"p-0"},Te={class:"flex flex-wrap gap-4"},Ce={class:"flex flex-col gap-4",style:{flex:"1 1 200px"}},Ae={class:"p-4 flex-1 relative"},Oe={class:"flex text-yellow-500 mb-2"},Re={class:"text-lg mb-4 flex items-center gap-2"},$e={class:"p-0"},Be=["href"],Ne={class:"p-0 text-xs"},Ue={class:"text-md"},qe={key:0,class:"mt-2"},De=["src"],Fe={__name:"ProductReviews",props:{product:{type:String,default:""}},setup(e){const t=e,s=H("https://db.chromatone.center/").with(oe()),i=_([]);W(async()=>{let y=await s.request(se("products",t.product,{fields:[{reviews:["*"]}]}));i.value=y.reviews.sort((o,v)=>o.date<v.date?1:-1)});const a=B(()=>i.value.reduce((y,o)=>y+=o.rating,0)/i.value.length),d=_(!1),n=_(!1),f=_(!1),h=_(null),O=y=>{h.value=y.target.files[0]},p=L({status:"draft",date:new Date().toISOString().split("T")[0],content:"",rating:5,author:"",author_link:"",product:t.product});async function P(y){const o=new FormData;if(h.value){o.append("folder","b84d5f23-aa89-498e-840d-9d34d79aa4fa"),o.append("file",h.value);let l=await s.request(Q(o));p.cover=l==null?void 0:l.id}let v=await s.request(X("reviews",p));console.log(v),f.value=!0}const R=B(()=>p.author&&p.content);return(y,o)=>{var v;return c(),u("div",re,[r("div",ie,[r("div",{class:"rounded p-4 flex gap-4 cursor-pointer bg-light-900 dark-bg-dark-200 flex-auto",onClick:o[0]||(o[0]=l=>d.value=!d.value)},[r("div",le,"Reviews ("+m(i.value.length)+")",1),o[6]||(o[6]=r("div",{class:"flex-auto"},null,-1)),((v=i.value)==null?void 0:v.length)>0?(c(),u("div",ne,[N(m(a.value.toFixed(1)),1),o[5]||(o[5]=r("div",{class:"i-la-star-solid text-yellow-500 text-lg"},null,-1))])):k("",!0),w(S,{name:"fade",mode:"out-in"},{default:j(()=>[d.value?(c(),u("div",ce)):(c(),u("div",de))]),_:1})]),r("button",{class:"p-4 bg-light-900 dark-bg-dark-200 rounded",onClick:o[1]||(o[1]=l=>n.value=!n.value),title:"Add a review","aria-label":"Add a review"},[r("div",{class:U(["i-la-plus",{"-rotate-45":n.value}])},null,2)])]),w(S,{name:"fade"},{default:j(()=>[f.value?(c(),u("div",ue,"Thank you! Your review has been submitted. It will be published after moderation.")):k("",!0)]),_:1}),w(S,{name:"fade"},{default:j(()=>[b(r("form",{class:"flex flex-col p-4 bg-light-900 dark-bg-dark-200 max-w-140 gap-4",onSubmit:E(P,["prevent","stop"])},[r("div",fe,[o[7]||(o[7]=N("Rating ")),o[8]||(o[8]=r("div",{class:"flex-1"},null,-1)),r("div",pe,m(g(p).rating),1),r("div",he,[(c(),u(T,null,C(5,l=>r("div",{class:"p-0 text-yellow-500 cursor-pointer",key:l,onClick:x=>g(p).rating=l},[l<=g(p).rating?(c(),u("div",ye)):(c(),u("div",ve))],8,ge)),64))])]),r("div",me,[r("div",_e,[o[9]||(o[9]=r("label",{class:"text-lg",for:"author"},"Author *",-1)),b(r("input",{id:"author","onUpdate:modelValue":o[2]||(o[2]=l=>g(p).author=l),placeholder:"Your name"},null,512),[[$,g(p).author]])]),r("div",be,[o[10]||(o[10]=r("label",{class:"text-lg",for:"author_link"},"Profile link",-1)),b(r("input",{id:"author_link","onUpdate:modelValue":o[3]||(o[3]=l=>g(p).author_link=l),placeholder:"A link to your social profile"},null,512),[[$,g(p).author_link]])])]),r("div",xe,[o[11]||(o[11]=r("label",{class:"text-lg",for:"form-content"},"Content *",-1)),b(r("textarea",{id:"form-content","onUpdate:modelValue":o[4]||(o[4]=l=>g(p).content=l),rows:"3",placeholder:"Describe your experience with the product"},null,512),[[$,g(p).content]])]),r("div",ke,[o[12]||(o[12]=r("label",{class:"text-lg",for:"files"},"Files",-1)),r("input",{id:"files",type:"file",name:"file",accept:"image/*",onChange:O,placeholder:"Describe your experience with the product"},null,32)]),o[13]||(o[13]=r("div",{class:"opacity-40"},"All reviews are manually moderated before being published.",-1)),r("button",{class:U(["p-4 bg-light-500 shadow rounded dark-bg-dark-800",{"opacity-50":!R.value}]),type:"submit",disabled:!R.value},[R.value?(c(),u("div",Se,"Submit")):(c(),u("div",je,"Please fill in your name and add review content"))],10,we)],544),[[q,n.value&&!f.value]])]),_:1}),w(S,{name:"fade"},{default:j(()=>[b(r("div",Te,[(c(!0),u(T,null,C(i.value,l=>(c(),u("div",{class:"shadow flex flex-wrap bg-light-400 dark-bg-dark-400 max-w-140",style:I({flex:`${l.cover?1e3:1} 1 280px`}),key:l},[r("div",Ce,[r("div",Ae,[r("div",Oe,[(c(!0),u(T,null,C(l.rating,x=>(c(),u("div",{class:"i-la-star-solid",key:x}))),128)),(c(!0),u(T,null,C(5-l.rating,x=>(c(),u("div",{class:"i-la-star",key:x}))),128))]),r("div",Re,[r("div",$e,m(l.author),1),l.author_link?(c(),u("a",{key:0,class:"i-la-link",target:"_blank",href:l.author_link},null,8,Be)):k("",!0),o[14]||(o[14]=r("div",{class:"flex-1"},null,-1)),r("div",Ne,m(l.date),1)]),r("div",Ue,m(l.content),1),l.cover?(c(),u("div",qe,[r("img",{class:"w-full max-w-50",src:`https://db.chromatone.center/assets/${l.cover}&w=10`},null,8,De)])):k("",!0)])])],4))),128))],512),[[q,d.value]])]),_:1})])}}},Pe=V(Fe,[["__scopeId","data-v-1f8ad0d2"]]);export{Pe as _};
