import{q as J,r as k,D as U,c as N,b as D,o as d,e as c,f as o,g as y,s as W,h as w,m as S,G as j,T,v as I,x as b,H as q,d as p,F as C,p as O,I as $,J as E,n as L,z as P,A as F}from"./framework.CyD6RqvT.js";var B={fetch:globalThis.fetch,WebSocket:globalThis.WebSocket,URL:globalThis.URL},M=(t,e={})=>{let s=e.globals?{...B,...e.globals}:B;return{globals:s,url:new s.URL(t),with(a){return{...this,...a(this)}}}};function z(t){return typeof t!="object"||!t?!1:"headers"in t&&"ok"in t&&"json"in t&&typeof t.json=="function"&&"text"in t&&typeof t.json=="function"}async function G(t){var e;if(!(typeof t!="object"||!t)){if(z(t)){let s=(e=t.headers.get("Content-Type"))==null?void 0:e.toLowerCase();if(s!=null&&s.startsWith("application/json")||s!=null&&s.startsWith("application/health+json")){let a=await t.json();if(!t.ok)throw a;return"data"in a?a.data:a}if(s!=null&&s.startsWith("text/html")||s!=null&&s.startsWith("text/plain")){let a=await t.text();if(!t.ok)throw a;return a}return t}return"data"in t?t.data:t}}var Y=async(t,e,s=globalThis.fetch)=>{e.headers=typeof e.headers=="object"&&!Array.isArray(e.headers)?e.headers:{};let a=await s(t,e);return G(a).catch(l=>{throw{errors:typeof l=="object"&&"errors"in l?l.errors:l,response:a}})},H=(t,e,s)=>()=>{let a=String(t);if(a.startsWith("directus_"))throw new Error("Cannot use createItem for core collections");return{path:`/items/${a}`,params:s??{},body:JSON.stringify(e),method:"POST"}},K=t=>{let e={};if(Array.isArray(t.fields)&&t.fields.length>0){let s=(a,l=[])=>{if(typeof a=="object"){let f=[];for(let r in a){let u=a[r]??[];if(Array.isArray(u))for(let n of u)f.push(s(n,[...l,r]));else if(typeof u=="object")for(let n of Object.keys(u)){let A=u[n];for(let v of A)f.push(s(v,[...l,`${r}:${n}`]))}}return f.flatMap(r=>r)}return[...l,String(a)].join(".")};e.fields=t.fields.flatMap(a=>s(a)).join(",")}t.filter&&Object.keys(t.filter).length>0&&(e.filter=JSON.stringify(t.filter)),t.search&&(e.search=t.search),"sort"in t&&t.sort&&(e.sort=typeof t.sort=="string"?t.sort:t.sort.join(",")),typeof t.limit=="number"&&t.limit>=-1&&(e.limit=String(t.limit)),typeof t.offset=="number"&&t.offset>=0&&(e.offset=String(t.offset)),typeof t.page=="number"&&t.page>=1&&(e.page=String(t.page)),t.deep&&Object.keys(t.deep).length>0&&(e.deep=JSON.stringify(t.deep)),t.alias&&Object.keys(t.alias).length>0&&(e.alias=JSON.stringify(t.alias)),t.aggregate&&Object.keys(t.aggregate).length>0&&(e.aggregate=JSON.stringify(t.aggregate)),t.groupBy&&t.groupBy.length>0&&(e.groupBy=t.groupBy.join(","));for(let[s,a]of Object.entries(t))s in e||(typeof a=="string"||typeof a=="number"||typeof a=="boolean"?e[s]=String(a):e[s]=JSON.stringify(a));return e},V=(t,e)=>{if(t.length===0)throw new Error(e)},Q=(t,e)=>{if(String(t).startsWith("directus_"))throw new Error(e)},X=(t,e,s)=>()=>(V(String(t),"Collection cannot be empty"),Q(t,"Cannot use readItem for core collections"),V(String(e),"Key cannot be empty"),{path:`/items/${t}/${e}`,params:s??{},method:"GET"}),Z={},tt=(t={})=>e=>{let s={...Z,...t};return{async request(a){let l=a();if(l.headers||(l.headers={}),"Content-Type"in l.headers?l.headers["Content-Type"]==="multipart/form-data"&&delete l.headers["Content-Type"]:l.headers["Content-Type"]="application/json","getToken"in this){let n=await this.getToken();n&&(l.headers||(l.headers={}),l.headers.Authorization=`Bearer ${n}`)}let f=st(e.url,l.path,l.params),r={method:l.method??"GET",headers:l.headers??{}};"credentials"in s&&(r.credentials=s.credentials),l.body&&(r.body=l.body),l.onRequest&&(r=await l.onRequest(r)),s.onRequest&&(r=await s.onRequest(r));let u=await Y(f.toString(),r,e.globals.fetch);return"onResponse"in l&&(u=await l.onResponse(u,r)),"onResponse"in t&&(u=await t.onResponse(u,r)),u}}},R="/",et=(t,e)=>(t.endsWith(R)&&(t=t.slice(0,-1)),e.startsWith(R)||(e=R+e),t+e),st=(t,e,s)=>{let a=t.pathname===R?e:et(t.pathname,e),l=new globalThis.URL(a,t);if(s)for(let[f,r]of Object.entries(K(s)))if(r&&typeof r=="object"&&!Array.isArray(r))for(let[u,n]of Object.entries(r))l.searchParams.set(`${f}[${u}]`,String(n));else l.searchParams.set(f,r);return l};const g=t=>(P("data-v-7b58912f"),t=t(),F(),t),at={class:"my-8"},ot={class:"flex gap-2 max-w-140 mb-4 text-xl"},lt={class:"p-0"},rt=g(()=>o("div",{class:"flex-auto"},null,-1)),it={key:0,class:"p-0 flex items-center gap-2"},nt=g(()=>o("div",{class:"i-la-star-solid text-yellow-500 text-lg"},null,-1)),dt={key:0,class:"i-la-angle-down"},ct={key:1,class:"i-la-angle-up"},ut={key:0,class:"p-4 bg-light-900 dark-bg-dark-200 max-w-140"},ht={class:"text-lg flex items-center gap-0",for:"rating"},ft=g(()=>o("div",{class:"flex-1"},null,-1)),pt={class:"px-2"},gt={class:"opacity-70 hover-opacity-100 gap-1 flex"},_t=["onClick"],yt={key:0,class:"i-la-star-solid"},vt={key:1,class:"i-la-star"},bt={class:"flex flex-wrap gap-2"},mt={class:"flex flex-col gap-2 flex-1"},xt=g(()=>o("label",{class:"text-lg",for:"author"},"Author *",-1)),kt={class:"flex flex-col gap-2 flex-1"},wt=g(()=>o("label",{class:"text-lg",for:"author_link"},"Profile link",-1)),St={class:"flex flex-col gap-2"},jt=g(()=>o("label",{class:"text-lg",for:"form-content"},"Content *",-1)),Tt=g(()=>o("div",{class:"opacity-40"},"All reviews are manually moderated before being published.",-1)),Ct=["disabled"],Ot={key:0,class:"text-red-500"},Rt={key:1,class:"p-0"},At={class:"flex flex-wrap gap-4"},$t={class:"flex flex-col gap-4",style:{flex:"1 1 200px"}},Nt={class:"p-4 flex-1 relative"},Wt={class:"flex text-yellow-500 mb-2"},It={class:"text-lg mb-4 flex items-center gap-2"},qt={class:"p-0"},Bt=["href"],Vt=g(()=>o("div",{class:"flex-1"},null,-1)),Jt={class:"p-0 text-xs"},Ut={class:"text-md"},Dt={key:0,class:"mt-2"},Et=["src"],Lt={__name:"ProductReviews",props:{product:{type:String,default:""}},setup(t){const e=t,s=M("https://db.chromatone.center/").with(tt()),a=k([]);U(async()=>{let _=await s.request(X("products",e.product,{fields:[{reviews:["*"]}]}));a.value=_.reviews.sort((h,m)=>h.date<m.date?1:-1)});const l=N(()=>a.value.reduce((_,h)=>_+=h.rating,0)/a.value.length),f=k(!1),r=k(!1),u=k(!1),n=D({status:"draft",date:new Date().toISOString().split("T")[0],title:"",content:"",rating:5,author:"",author_link:"",product:e.product});async function A(){console.log(n);let _=await s.request(H("reviews",n));console.log(_),u.value=!0}const v=N(()=>n.author&&n.content);return(_,h)=>{var m;return d(),c("div",at,[o("div",ot,[o("div",{class:"rounded p-4 flex gap-4 cursor-pointer bg-light-900 dark-bg-dark-200 flex-auto",onClick:h[0]||(h[0]=i=>f.value=!f.value)},[o("div",lt,"Reviews ("+y(a.value.length)+")",1),rt,((m=a.value)==null?void 0:m.length)>0?(d(),c("div",it,[W(y(l.value.toFixed(1)),1),nt])):w("",!0),S(T,{name:"fade",mode:"out-in"},{default:j(()=>[f.value?(d(),c("div",ct)):(d(),c("div",dt))]),_:1})]),o("button",{class:"p-4 bg-light-900 dark-bg-dark-200 rounded",onClick:h[1]||(h[1]=i=>r.value=!r.value),title:"Add a review","aria-label":"Add a review"},[o("div",{class:I(["i-la-plus",{"-rotate-45":r.value}])},null,2)])]),S(T,{name:"fade"},{default:j(()=>[u.value?(d(),c("div",ut,"Thank you! Your review has been submitted. It will be published after moderation.")):w("",!0)]),_:1}),S(T,{name:"fade"},{default:j(()=>[b(o("form",{class:"flex flex-col p-4 bg-light-900 dark-bg-dark-200 max-w-140 gap-4",onSubmit:h[5]||(h[5]=E(i=>A(),["prevent","stop"]))},[o("div",ht,[W("Rating "),ft,o("div",pt,y(p(n).rating),1),o("div",gt,[(d(),c(C,null,O(5,i=>o("div",{class:"p-0 text-yellow-500 cursor-pointer",key:i,onClick:x=>p(n).rating=i},[i<=p(n).rating?(d(),c("div",yt)):(d(),c("div",vt))],8,_t)),64))])]),o("div",bt,[o("div",mt,[xt,b(o("input",{id:"author","onUpdate:modelValue":h[2]||(h[2]=i=>p(n).author=i),placeholder:"Your name"},null,512),[[$,p(n).author]])]),o("div",kt,[wt,b(o("input",{id:"author_link","onUpdate:modelValue":h[3]||(h[3]=i=>p(n).author_link=i),placeholder:"A link to your social profile"},null,512),[[$,p(n).author_link]])])]),o("div",St,[jt,b(o("textarea",{id:"form-content","onUpdate:modelValue":h[4]||(h[4]=i=>p(n).content=i),rows:"3",placeholder:"Describe your experience with the product"},null,512),[[$,p(n).content]])]),Tt,o("button",{class:I(["p-4 bg-light-500 shadow rounded dark-bg-dark-800",{"opacity-50":!v.value}]),type:"submit",disabled:!v.value},[v.value?(d(),c("div",Rt,"Submit")):(d(),c("div",Ot,"Please fill in your name and add review content"))],10,Ct)],544),[[q,r.value&&!u.value]])]),_:1}),S(T,{name:"fade"},{default:j(()=>[b(o("div",At,[(d(!0),c(C,null,O(a.value,i=>(d(),c("div",{class:"shadow flex flex-wrap bg-light-400 dark-bg-dark-400 max-w-140",style:L({flex:`${i.cover?1e3:1} 1 280px`}),key:i},[o("div",$t,[o("div",Nt,[o("div",Wt,[(d(!0),c(C,null,O(i.rating,x=>(d(),c("div",{class:"i-la-star-solid",key:x}))),128)),(d(!0),c(C,null,O(5-i.rating,x=>(d(),c("div",{class:"i-la-star",key:x}))),128))]),o("div",It,[o("div",qt,y(i.author),1),i.author_link?(d(),c("a",{key:0,class:"i-la-link",target:"_blank",href:i.author_link},null,8,Bt)):w("",!0),Vt,o("div",Jt,y(i.date),1)]),o("div",Ut,y(i.content),1),i.cover?(d(),c("div",Dt,[o("img",{class:"w-full max-w-50",src:`https://db.chromatone.center/assets/${i.cover}&w=10`},null,8,Et)])):w("",!0)])])],4))),128))],512),[[q,f.value]])]),_:1})])}}},Ft=J(Lt,[["__scopeId","data-v-7b58912f"]]);export{Ft as _};
